{
  "filename": "cluster-flow-control.md",
  "__html": "<h1>Cluster Flow Control</h1>\n<h2>Introduction</h2>\n<p>Cluster flow control is useful in plenty of scenarios. For example:</p>\n<ul>\n<li>There are 50 instances in the service cluster, and you're going to limit the frequency of one invocation to 10 per second in total.</li>\n<li>The traffic towards each instance might be uneven, so if we set local flow rules, requests might be blocked when specific instances are targeted with large traffic, while the total QPS has not reached the threshold sum.</li>\n</ul>\n<img src=\"https://user-images.githubusercontent.com/9434884/65305357-8f39bc80-dbb5-11e9-96d6-d1111fc365a9.png\" alt=\"clustr-token-server-overview\" height=\"75%\" width=\"75%\">\n<h2>Cluster Flow Rule</h2>\n<p>In <code>FlowRule</code>:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> clusterMode; <span class=\"hljs-comment\">// whether to enable the cluster mode</span>\n<span class=\"hljs-keyword\">private</span> ClusterFlowConfig clusterConfig; <span class=\"hljs-comment\">// items about the cluster flow control</span>\n</code></pre>\n<p>In <code>ClusterFlowConfig</code>:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-comment\">// Required and unique. Usually assigned by the dashboard</span>\n<span class=\"hljs-keyword\">private</span> Long flowId;\n\n<span class=\"hljs-comment\">// Threshold type. 0 for average threshold (per instance), 1 for global threshold.</span>\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> thresholdType = ClusterRuleConstant.FLOW_THRESHOLD_AVG_LOCAL;\n\n<span class=\"hljs-comment\">// Whether to fallback to local flow control if the transport between token client and server failed</span>\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> fallbackToLocalWhenFail = <span class=\"hljs-keyword\">true</span>;\n</code></pre>\n<h2>Flow control for service mesh</h2>\n<ul>\n<li><a href=\"./envoy-global-rate-limiting-support.md\">Envoy Global Rate Limiting Support</a></li>\n</ul>\n"
}